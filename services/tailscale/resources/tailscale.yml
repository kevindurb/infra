---
apiVersion: v1
kind: Pod
metadata:
  name: subnet-router
spec:
  serviceAccountName: tailscale
  containers:
    - name: kube-subnet-router
      imagePullPolicy: Always
      image: ghcr.io/tailscale/tailscale:latest
      env:
        - name: TS_USERSPACE
          value: 'true'
        - name: TS_ROUTES
          value: '10.0.0.0/8'
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: tailscale
rules:
  - apiGroups: ['']
    resourceNames: ['tailscale']
    resources: ['secrets']
    verbs: ['get', 'update', 'patch']

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: tailscale
subjects:
  - kind: ServiceAccount
    name: tailscale
roleRef:
  kind: Role
  name: tailscale
  apiGroup: rbac.authorization.k8s.io

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: tailscale
