# !yamlfmt!:ignore
---
# yaml-language-server: $schema=https://www.authelia.com/schemas/v4.38/json-schema/configuration.json
theme: auto

log:
  level: debug

totp:
  disable: false
  issuer: authelia.com

webauthn:
  disable: true

duo_api:
  disable: true

authentication_backend:
  password_reset:
    disable: true
  file:
    path: /config/users.yml

access_control:
  default_policy: two_factor

session:
  redis:
    host: authelia-session-service

  cookies:
    - domain: durbin.casa
      authelia_url: https://auth.durbin.casa

storage:
  postgres: {}

notifier:
  disable_startup_check: true
  smtp:
    address: smtp.fastmail.com:465
identity_providers:
  oidc:
    # prettier-ignore
    jwks:
      - key: {{ env "OIDC_JWKS_KEY" | mindent 10 "|" | msquote }}
    cors:
      endpoints:
        - authorization
        - token
        - revocation
        - introspection
        - userinfo
        - pushed-authorization-request
    clients:
      - client_name: Mealie
        client_id: mealie
        public: true
        require_pkce: true
        pkce_challenge_method: 'S256'
        authorization_policy: two_factor
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, groups, email]
        redirect_uris: [https://mealie.durbin.casa/login]
        userinfo_signed_response_alg: none
        token_endpoint_auth_method: none

      - client_name: Vikunja
        client_id: vikunja
        client_secret: '{{ env "VIKUNJA_CLIENT_SECRET_HASH" }}'
        public: false
        authorization_policy: two_factor
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, email]
        redirect_uris: [https://vikunja.durbin.casa/auth/openid/authelia]
        userinfo_signed_response_alg: none
        token_endpoint_auth_method: client_secret_basic

      - client_name: ArgoCD
        client_id: argocd
        client_secret: '{{ env "ARGOCD_CLIENT_SECRET_HASH" }}'
        public: false
        authorization_policy: two_factor
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, email, groups]
        redirect_uris: [https://argo.beaver-cloud.ts.net/auth/callback]
        userinfo_signed_response_alg: none
