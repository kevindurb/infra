# !yamlfmt!:ignore
---
# yaml-language-server: $schema=https://www.authelia.com/schemas/v4.38/json-schema/configuration.json
theme: auto

log:
  level: debug

totp:
  disable: false
  issuer: authelia.com

webauthn:
  disable: false

duo_api:
  disable: true

authentication_backend:
  password_reset:
    disable: true
  file:
    path: /config/users.yml

access_control:
  default_policy: two_factor

session:
  redis:
    host: authelia-session-service

  cookies:
    - domain: durbin.casa
      authelia_url: https://auth.durbin.casa

storage:
  postgres: {}

notifier:
  disable_startup_check: false
  smtp:
    host: smtp.fastmail.com
    port: 465
identity_providers:
  oidc:
    # prettier-ignore
    jwks:
      - key: {{ env "OIDC_JWKS_KEY" | mindent 10 "|" | msquote }}
    cors:
      endpoints:
        - authorization
        - token
        - revocation
        - introspection
        - userinfo
        - pushed-authorization-request
    clients:
      - client_name: Mealie
        client_id: mealie
        public: true
        require_pkce: true
        pkce_challenge_method: 'S256'
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, groups, email]
        redirect_uris: [https://mealie.durbin.casa/login]
        token_endpoint_auth_method: none

      - client_name: Vikunja
        client_id: vikunja
        client_secret: '{{ env "VIKUNJA_CLIENT_SECRET_HASH" }}'
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, email]
        redirect_uris: [https://vikunja.durbin.casa/auth/openid/authelia]

      - client_name: ArgoCD
        client_id: argocd
        client_secret: '{{ env "ARGOCD_CLIENT_SECRET_HASH" }}'
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, email, groups]
        redirect_uris: [https://argo.beaver-cloud.ts.net/auth/callback]
        token_endpoint_auth_method: client_secret_post

      - client_name: Linkwarden
        client_id: linkwarden
        client_secret: '{{ env "LINKWARDEN_CLIENT_SECRET_HASH" }}'
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, email, groups]
        redirect_uris: [https://linkwarden.durbin.casa/api/v1/auth/callback/keycloak]

      - client_name: Immich
        client_id: immich
        client_secret: '{{ env "IMMICH_CLIENT_SECRET_HASH" }}'
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, email, groups]
        redirect_uris:
          - app.immich:/
          - https://immich.durbin.casa/auth/login
          - https://immich.durbin.casa/user-settings

      - client_name: Grafana
        client_id: grafana
        client_secret: '{{ env "GRAFANA_CLIENT_SECRET_HASH" }}'
        require_pkce: true
        pkce_challenge_method: 'S256'
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, email, groups]
        redirect_uris: [https://grafana.beaver-cloud.ts.net/login/generic_oauth]

      - client_name: Nextcloud
        client_id: nextcloud
        client_secret: '{{ env "NEXTCLOUD_CLIENT_SECRET_HASH" }}'
        require_pkce: true
        pkce_challenge_method: 'S256'
        pre_configured_consent_duration: 1y
        scopes: [openid, profile, email, groups]
        redirect_uris: [https://nextcloud.durbin.casa/apps/user_oidc/code]
        token_endpoint_auth_method: client_secret_post
