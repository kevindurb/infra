---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: deployment
spec:
  replicas: 1
  strategy:
    type: Recreate
  template:
    spec:
      containers:
        - name: open-webui
          image: ghcr.io/open-webui/open-webui:0.3.35@sha256:89fffc09527cebeb4d4cf268a6435a4f3ee8c07f72618b607a0fa3eef0ffc1c8
          resources:
            requests:
              memory: 500M
            limits:
              memory: 2G
          env:
            - name: DEFAULT_MODELS
              value: llama3.2
            - name: ENABLE_OLLAMA_API
              value: 'true'
            - name: OLLAMA_BASE_URL
              value: http://ollama-service
            - name: WEBUI_URL
              value: https://chat.durbin.casa
            - name: ENABLE_RAG_WEB_SEARCH
              value: 'true'
            - name: ENABLE_SEARCH_QUERY
              value: 'true'
            - name: RAG_WEB_SEARCH_ENGINE
              value: searxng
            - name: SEARXNG_QUERY_URL
              value: http://searxng-service.default/search?q=<query>
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: open-webui-postgres-app
                  key: uri
          ports:
            - name: web
              containerPort: 8080

---
apiVersion: v1
kind: Service
metadata:
  name: service
spec:
  ports:
    - name: web
      port: 80
      targetPort: web
